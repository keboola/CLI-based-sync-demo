name: Keboola Storage validation pull
description: Pulling from Keboola project storage structure
inputs:
  destFile:
    description: Destination file
    required: true
  kbcStorageApiHost:
    description: Keboola Connection Stack URL
    required: true
  kbcStorageApiToken:
    description: Keboola Connection Storage API Token
    required: true
runs:
  using: "composite"
  steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: get random number
      id: random_number
      uses: yakubique/random-number@v1.1
      with:
        min: 1
        max: 1000

    - name: Def out directory
      id: def_dir
      run: |
        echo "OUT_DIR=projects_structure_${{ steps.random_number.outputs.number }}" >> "${GITHUB_OUTPUT}"
      shell: bash

    - name: Pull storage structure
      shell: bash
      run: |
        python3 .github/actions/kbc_storage_validation/pull/storage_pull.py \
          --host="${{ inputs.kbcStorageApiHost }}" \
          --token="${{ inputs.kbcStorageApiToken }}" \
          --destination-file="${{ steps.def_dir.output.OUT_DIR }}/${{ inputs.destFile }}"

    - name: Save structure to artifact
      uses: actions/upload-artifact@v4
      with:
        name: ${{ steps.def_dir.output.OUT_DIR }}
        path: ${{ steps.def_dir.output.OUT_DIR }}/*
        retention-days: 5
