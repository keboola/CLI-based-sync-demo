name: Keboola Storage structure pull
description: Pulling from Keboola projects structure of storage
inputs:
  workdir:
    description: Working directory
    required: true
  kbcStorageApiHost:
    description: Keboola Connection Stack URL
    required: true
  kbcStorageApiToken:
    description: Keboola Connection Storage API Token
    required: true
  kbcProjectId:
    description: Keboola Connection Project ID
    required: true
  kbcBranchId:
    description: Keboola Connection Branch ID
    required: true
runs:
  using: "composite"
  steps:
    - name: Pull
      id: pull
      env:
        KBC_STORAGE_API_TOKEN: ${{ inputs.kbcStorageApiToken }}
        KBC_STORAGE_API_HOST: ${{ inputs.kbcStorageApiHost }}
      shell: bash
      run: |
        echo "dest_file=${{ inputs.workdir }}_${{ inputs.kbcProjectId }}.json"
        echo "$dest_file"
        echo "dest_file=$dest_file">> $GITHUB_OUTPUT
        python3 .github/actions/kbc_storage_validation/pull/storage_pull.py --host="$KBC_STORAGE_API_HOST" --token="$KBC_STORAGE_API_TOKEN" --destination-file="$dest_file"
    - name: Upload output file
      uses: actions/upload-artifact@v4
      with:
        name: ${{ steps.pull.outputs.dest_file }}
        path: ${{ steps.pull.outputs.dest_file }}